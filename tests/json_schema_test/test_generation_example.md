# Testing JSON Schema Generation with example.idl

This document shows how to test the actual JSON schema code generation using the decorated `example.idl` file.

## Steps to Test Real Code Generation

### 1. Generate Code from IDL
The IDL code generation is integrated into the build system using `RPCGenerate()` function:

```bash
cd /path/to/rpc

# Configure and build the project (this will automatically generate IDL code)
cmake --preset Debug
cmake --build build --target example_idl  # or cmake --build build for all targets
```

### 2. Generated Files Location
The code is automatically generated by the build system into:
- `build/generated/example/example.h` - Interface declarations with JSON schema metadata  
- `build/generated/example/example.cpp` - Implementation with function_info containing descriptions and schemas
- Other generated files (stubs, proxies, etc.)

The `RPCGenerate()` function in `/tests/idls/CMakeLists.txt` handles the code generation automatically.

### 3. Example Generated function_info

For the IDL function:
```idl
[description="Adds two integers and returns the result"] 
error_code add(int a, int b, [out, by_value] int& c);
```

The generated `i_example::get_function_info()` will include:
```cpp
functions.emplace_back(rpc::function_info{
    "yyy.i_example.add",
    "add", 
    {1}, 
    0, 
    false,
    "Adds two integers and returns the result",
    "{\"type\":\"object\",\"description\":\"Input parameters for add method\",\"properties\":{\"a\":{\"type\":\"integer\"},\"b\":{\"type\":\"integer\"}},\"required\":[\"a\",\"b\"],\"additionalProperties\":false}"
});
```

### 4. Test the Generated Code

Create a simple test program that uses the generated headers:
```cpp
#include "example/example.h"  // Generated header from build/generated/example/
#include <iostream>

int main() {
    // Query function metadata
    auto functions = yyy::i_example::get_function_info();
    
    for (const auto& func : functions) {
        std::cout << "Function: " << func.name << std::endl;
        std::cout << "Description: " << func.description << std::endl;
        std::cout << "Schema: " << func.json_schema << std::endl;
        std::cout << "---" << std::endl;
    }
    
    return 0;
}
```

Compile with:
```bash
cd /path/to/rpc
g++ -std=c++17 -I build/generated -I rpc/include test_json_schema_real.cpp -o test_json_schema_real
./test_json_schema_real
```

### 5. Verify JSON Schema Compatibility

The generated metadata can be used directly with JSON schema tools:
- `func.description` provides human-readable function descriptions
- `func.json_schema` provides JSON Schema for parameter validation
- Both fields are automatically populated from IDL descriptions

## Current Status

âœ… **IDL Decorated**: `../idls/example/example.idl` has descriptions for all functions
âœ… **Generator Enhanced**: Code generator produces JSON schema-compatible metadata  
âœ… **Tests Available**: Mock tests in this directory validate the concept
ðŸ”„ **Integration Ready**: Ready to test with actual generated code

## Next Steps

1. Run the generator on the decorated example.idl
2. Compile and test the generated code
3. Verify JSON schema metadata is properly generated
4. Integrate with your JSON schema service implementation